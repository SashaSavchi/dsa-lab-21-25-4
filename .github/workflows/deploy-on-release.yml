name: Deploy Versions

on:
  release:
    types: [published]

jobs:
  create-version:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          ref: master
          
      - name: Create version directory
        run: |
          TAG="${{ github.event.release.tag_name }}"
          echo "Using tag: $TAG"
          mkdir -p "versions/$TAG"
          [ -f ./index.html ] && cp -a ./index.html "versions/$TAG/index.html"
          [ -d ./ru ] && cp -a ./ru "versions/$TAG/ru"
          [ -d ./en ] && cp -a ./en "versions/$TAG/en"
          echo "Contents of versions/$TAG:"
          ls -la "versions/$TAG"
          
      - name: Commit and push
        run: |
          git config --global user.name "GitHub Actions"
          git config --global user.email "actions@github.com"
          git checkout master
          git add versions/
          git diff --cached --quiet || git commit -m "Add version ${{ github.event.release.tag_name }}"
          git push origin master